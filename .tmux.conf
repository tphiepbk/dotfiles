########################################################################
# AUTHOR: Hiep Phuc Thai (EXT) - zthahie                               #
# It takes me 2 years to finish this shiet, but it's worth every penny #
# It's not just about the implementation, it's about the idea also     #
########################################################################

unbind C-b
set -g prefix C-b

# Settings to work with Neovim
set -sg escape-time 0
set-option -g focus-events on
set -g default-terminal "xterm-256color"
set -ga terminal-overrides ',xterm-256color:RGB'

set -g mouse off

# Unlimit history
set -g history-limit 9999999

# Status settings
set -g status-interval 1
set-option -g status 2

# Set key mode to vi
setw -g mode-keys vi

# Define icons
# { left = '', right = '' }
HALF_ROUND_OPEN_ICON="#(printf '\ue0b6')"
HALF_ROUND_CLOSE_ICON="#(printf '\ue0b4')"
# { left = '', right = '' }
TRIANGLE_OPEN_ICON="#(printf '\ue0b2')"
TRIANGLE_CLOSE_ICON="#(printf '\ue0b0')"
# { right = '', left = '' }
SLOPE_OPEN_ICON="#(printf '\ue0ba')"
SLOPE_CLOSE_ICON="#(printf '\ue0b8')"

OPEN_ICON="${HALF_ROUND_OPEN_ICON}"
CLOSE_ICON="${HALF_ROUND_CLOSE_ICON}"

WINDOW_ICON="\uf2d2"

TROPHY_ICON="#(printf '\uf091')"
HOUSE_ICON="#(printf '\uf015')"
MUG_SAUCER_ICON="#(printf '\uf0f4')"
MICROCHIP_ICON="#(printf '\uf2db')"
DATABASE_ICON="#(printf '\uf1c0')"
GLOBE_ICON="#(printf '\uf0ac')"

# Windows settings
set -g window-status-separator " ${WINDOW_ICON}  "
set-window-option -g window-status-current-style fg=color226,bg=color22
set-option -g window-status-current-format "\
#[fg=color22,bg=color16]${OPEN_ICON}\
#[bg=color22,fg=color226]#I:#W#F\
#[fg=color22,bg=color16]${CLOSE_ICON}\
"
bind-key -n C-S-Left swap-window -t -1\; select-window -t -1
bind-key -n C-S-Right swap-window -t +1\; select-window -t +1

# Patnes settings
set -g pane-active-border-style bg=default,fg=color196
set -g pane-border-style bg=default,fg=color35
set -g pane-border-status "off"
set -g pane-border-format "#h:#{pane_current_path}"
set -g pane-border-lines "heavy"
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Source configuration easily
bind r run-shell "tmux source-file ~/.tmux.conf > /dev/null;\
tmux display-message 'Sourced tmux configuration !'"

# Copy mode settings
bind P paste-buffer
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -input -selection clipboard"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -input -selection clipboard"

# Format the first line of status bar
set-option -g status-format[0] "#[align=left range=left #{status-left-style}]#[push-default]#{T;=/#{status-left-length}:status-left}#[pop-default]#[norange default]\
\
#[list=on align=#{status-justify}]#[list=left-marker]<#[list=right-marker]>#[list=on] #{W:#[range=window|#{window_index} #{window-status-style}#{?#{&&:#{window_last_flag},#{!=:#{window-status-last-style},default}}, #{window-status-last-style},}#{?#{&&:#{window_bell_flag},#{!=:#{window-status-bell-style},default}}, #{window-status-bell-style},#{?#{&&:#{||:#{window_activity_flag},#{window_silence_flag}},#{!=:#{window-status-activity-style},default}}, #{window-status-activity-style},}}]#[push-default]#{T:window-status-format}#[pop-default]#[norange default]#{?window_end_flag,,#{window-status-separator}},#[range=window|#{window_index} list=focus #{?#{!=:#{window-status-current-style},default},#{window-status-current-style},#{window-status-style}}#{?#{&&:#{window_last_flag},#{!=:#{window-status-last-style},default}}, #{window-status-last-style},}#{?#{&&:#{window_bell_flag},#{!=:#{window-status-bell-style},default}}, #{window-status-bell-style},#{?#{&&:#{||:#{window_activity_flag},#{window_silence_flag}},#{!=:#{window-status-activity-style},default}}, #{window-status-activity-style},}}]#[push-default]#{T:window-status-current-format}#[pop-default]#[norange list=on default]#{?window_end_flag,,#{window-status-separator}}}\
\
#[nolist align=right range=right #{status-right-style}]#[push-default]#{T;=/#{status-right-length}:status-right}#[pop-default]#[norange default]"

set-option -g status-justify centre
set-option -g status-keys vi

set-option -g status-style fg=color15,bg=color16

set-option -g status-left-length 100
set-option -g status-left-style default
set-option -g status-left "\
#[fg=color159,bg=color91] #(tmux -V | awk '{ print toupper($0) }') \
#[fg=color91,bg=color16]${CLOSE_ICON}\
#[fg=color255,bg=color16] ${TROPHY_ICON}  \
#[fg=color166,bg=color16]${OPEN_ICON}\
#[fg=color231,bg=color166] #(hostname) \
#[fg=color166,bg=color16]${CLOSE_ICON}\
#[fg=color255,bg=color16] ${HOUSE_ICON}  \
#[fg=color160,bg=color16]${OPEN_ICON}\
#[fg=color190,bg=color160] #{session_name} \
#[fg=color160,bg=color16]${CLOSE_ICON}\
#[fg=color255,bg=color16] ${MUG_SAUCER_ICON}"

set-option -g status-right-length 100
set-option -g status-right-style default
set-option -g status-right "\
#[fg=color255,bg=color16]${MICROCHIP_ICON}  \
#[fg=color89,bg=color16]${OPEN_ICON}\
#[fg=color226,bg=color89] CPU #( bash ~/.tmux/scripts/tmux_get_cpu_stat.sh used ) \
#[fg=color89,bg=color16]${CLOSE_ICON}\
#[fg=color255,bg=color16] ${DATABASE_ICON}  \
#[fg=color52,bg=color16]${OPEN_ICON}\
#[fg=color226,bg=color52] RAM #( bash ~/.tmux/scripts/tmux_get_mem_stat.sh used gb ) "

# Format the second line of status bar
set -g status-format[1] "#[align=left]#[bg=color16, fg=color118] AUSTRALIA/Melbourne \
#[bg=color16, fg=color15]${GLOBE_ICON}  \
#[bg=color16, fg=color14]#( bash ~/.tmux/scripts/tmux_get_time.sh AU static)"
set -ag status-format[1] "#[align=centre]#[fg=color18,bg=color16]${OPEN_ICON}\
#[bg=color18, fg=color118] Central European Time (CET) \
#[bg=color18, fg=color15]${GLOBE_ICON}  \
#[bg=color18, fg=color226]#( bash ~/.tmux/scripts/tmux_get_time.sh CET static) \
#[fg=color18,bg=color16]${CLOSE_ICON}"
set -ag status-format[1] "#[align=right]#[bg=color16, fg=color118] VIETNAM/Ho Chi Minh City \
#[bg=color16, fg=color15]${GLOBE_ICON}  \
#[bg=color16, fg=color14]#( bash ~/.tmux/scripts/tmux_get_time.sh VN static) "

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'b0o/tmux-autoreload'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Configuration for tmux-autoreload plugin
set -g @tmux-autoreload-quiet 1

# Restore neovim session
set -g @resurrect-strategy-nvim 'session'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

